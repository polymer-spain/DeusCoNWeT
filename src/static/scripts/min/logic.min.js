!function(){"use strict";var a=angular.module("picbit",["ngAnimate","ngResource","ngRoute","ngSanitize","ngTouch","ng-polymer-elements"]);a.config(["$locationProvider","$routeProvider","$httpProvider",function(a,b,c){c.defaults.withCredentials=!0,b.when("/",{templateUrl:"views/landingPage.html",controller:"LandingController",resolve:{auth:["$cookies","$backend","$rootScope","$q","$location",function(a,b,c,d,e){var f=a.get("session"),g=a.get("user"),h=a.get("social_network");f&&g&&h&&b.getUser(g).then(function(a){return c.user=a.data,c.isLogged=!0,c.unauthorized?void 0:(e.path("/user/"+g),d.when())},function(a){return console.error(a.data.error),b.logout(),d.when()})}]}}).when("/user/:user_id",{templateUrl:"views/userHome.html",controller:"UserHomeController",resolve:{auth:["$q","$cookies","$backend","$rootScope","$route",function(a,b,c,d,e){var f=b.get("session"),g=b.get("user");return e.current.params.user_id!==g?a.reject({authorized:!1}):f&&g?void c.getUser(g).then(function(b){return d.user=b.data,d.isLogged=!0,a.when(f)},function(b){return console.error("Error "+b.status+": al intentar coger los datos del usuario "+g),a.reject()}):a.reject({authenticated:!1})}]}}).when("/about",{templateUrl:"views/about.html",controller:"AboutController"}).when("/contact",{templateUrl:"views/contact.html",controller:"ContactController"}).when("/user/:userId/profile",{templateUrl:"views/profile.html",controller:"ProfileController",resolve:{auth:["$q","$cookies","$backend","$rootScope",function(a,b,c,d){var e=b.get("session"),f=b.get("user");return e&&f?void c.getUser(f).then(function(b){return d.user=b.data,a.when(e)},function(b){return console.error("Error "+b.status+": al intentar coger los datos del usuario "+f),a.reject()}):a.reject({authenticated:!1})}]}}).when("/privacy",{templateUrl:"views/privacy.html",controller:"PrivacyController"}).when("/selectId",{templateUrl:"views/selectId.html",controller:"SelectidController",resolve:{auth:["$q","$rootScope",function(a,b){return b.register?a.when(b.register):a.reject({register:!1})}]}}).otherwise({redirectTo:"/"}),a.html5Mode(!0)}]),a.run(["$rootScope","$location",function(a,b){a.$on("$routeChangeError",function(c,d,e,f){f.authorized?f.authenticated&&f.register||b.path("/"):(a.unauthorized=!0,b.path("/"))})}])}(wrap(document)),angular.module("picbit").controller("MainController",["$scope","$location","$timeout","$backend","$http","$window","$cookies","$rootScope","RequestLanguage",function(a,b,c,d,e,f,g,h,i){"use strict";g.get("user")&&d.getUser(g.get("user")).then(function(a){h.user=a.data}),h.isLogged=h.user?!0:!1,a.domain="https://"+b.host(),a.shadow=!1,a.sended=!1,a.idioma=g.get("language")||f.navigator.language,a.languageRequest=function(b){i.language(b).success(function(b){a.language=b,a.languageSelected=b.lang[a.idioma]})},a.changelanguage=function(b){var c;a.idioma=b,g.put("language",b),c="es"===a.idioma?"es_es.json":"en_en.json",a.languageRequest(c),document.querySelector("#language").$.label.innerHTML=a.languageSelected},"es"===a.idioma?(a.languageRequest("es_es.json"),a.idioma="es",g.put("language","es")):(a.languageRequest("en_en.json"),a.idioma="en",g.put("language","en")),a.loginProcess=function(c){function e(b){h.register={token:b.token,redSocial:b.redSocial,tokenId:b.userId,oauthVerifier:b.oauth_verifier},a.changeView("/selectId")}-1===b.$$path.indexOf("profile")?d.getUserId(c.userId,c.redSocial).then(function(b){h.user=b.data,d.sendData(c.token,c.userId,b.data.user_id,c.redSocial,c.oauth_verifier).then(function(){a.changeView("/user/"+h.user.user_id)},function(a){console.error("Error "+a.status+": al intentar mandar los datos de login")})},e(c)):d.sendData(c.token,h.user.user_id,c.redSocial)},a.logged=function(b){a.$apply(function(){if(a.hidePopup(),"googleplus"===b.detail.redSocial){var c;c="https://www.googleapis.com/plus/v1/people/me?access_token="+b.detail.token,e.get(c).success(function(c){b.detail.userId=c.id,a.loginProcess(b.detail)})}else if("twitter"===b.detail.redSocial){var c=d.endpoint+"/api/oauth/twitter/authorization/"+b.detail.oauth_verifier;e.get(c).success(function(c){b.detail.userId=c.token_id,a.loginProcess(b.detail)}).error(function(){console.log("Problemas al intentar obtener el token_id de un usuario")})}else a.loginProcess(b.detail)})},a.changeView=function(a){b.hash(""),b.path(a)},a["goto"]=function(b){switch(b){case"home":a.changeView("user/"+h.user.user_id);break;case"profile":a.changeView("user/"+h.user.user_id+"/profile")}},a.logout=function(){d.logout().then(function(){a.changeView("/")},function(a){console.error("Error "+a.status+": Fallo al intentar realizar un logout del usurio "+h.user.name)})},a.showPopup=function(){h.isLogged?a.changeView("user/213"):(a.popup=!0,a.shadow=!0,window.onkeydown=a.listenEscKeydown)},a.hidePopup=function(){a.popup=!1,a.shadow=!1,window.removeEventListener("onkeydown",a.listenEscKeydown)},f.addEventListener("scroll",function(){a.$apply(function(){var b=document.body.scrollTop;a.scrolled=b>0})}),a.dropmenu=function(){document.querySelector("#dropmenu").toggle()},a.listenEscKeydown=function(b){a.$apply(function(){27===b.keyCode&&a.hidePopup()})},function(){document.querySelector("body").addEventListener("google-logged",a.logged),document.querySelector("body").addEventListener("linkedin-logged",a.logged),document.querySelector("body").addEventListener("github-logged",a.logged),document.querySelector("body").addEventListener("instagram-logged",a.logged),document.querySelector("body").addEventListener("twitter-logged",a.logged),document.querySelector("body").addEventListener("facebook-logged",a.logged),document.querySelector("body").addEventListener("sof-logged",a.logged)}()}]),angular.module("picbit").controller("LandingController",["$scope","$timeout","$location","$anchorSmoothScroll","$anchorScroll","$backend",function(a,b,c,d,e,f){"use strict";"section1"===c.hash()?a.selected=1:"section2"===c.hash()?a.selected=2:"section3"===c.hash()?a.selected=3:"section4"===c.hash()?a.selected=4:a.selected=1,a.cambiarAnchor=function(a){c.hash(a),d.scrollTo(a)},a["goto"]=function(b){a.selected=b,c.hash("section"+b),e()},a.setStyle=function(a,b){document.querySelector(a).removeAttribute("selected"),document.querySelector(b).setAttribute("selected",!0)},a.sub=function(){var b,c,d,e;if(b=document.querySelector("#namesus"),c=document.querySelector("#sendersus"),d=document.querySelector("#surnamesus"),e=document.querySelector("#invalid"),e.innerHTML="",b.value||(e.innerHTML="* El nombre es obligatorio"),d.value||(e.innerHTML&&(e.innerHTML+="<br>"),e.innerHTML+="* El apellido es obligatorio"),c.value&&c.checkValidity()||(e.innerHTML&&(e.innerHTML+="<br>"),e.innerHTML+="* El correo debe ser valido"),b.value&&c.checkValidity()&&d.value){var g,h;g=function(f,g){201===g?(b.value="",c.value="",d.value="",a.$parent.shadow=!0,a.$parent.sended=!0):200===g&&(e.innerHTML="* Ya esta registrado para la beta",b.value="",c.value="",d.value="")},h=function(){e.innerHTML="* Ahora mismo no podemos tratar su petición, intentelo mas tarde"},f.sendSub(b.value,c.value,d.value,g,h)}},a.wheel=function(b){document.onmousewheel="",a.$apply(function(){b.preventDefault();var c;c=b.wheelDelta<0?1:-1,1===a.selected&&b.wheelDelta<0?(a.selected+=c,a.cambiarAnchor("section2")):2===a.selected?(a.selected+=c,a.cambiarAnchor("section"+a.selected)):3===a.selected?(a.selected+=c,a.cambiarAnchor("section"+a.selected)):4===a.selected&&b.wheelDelta>0&&(a.selected+=c,a.cambiarAnchor("section3")),document.onmousewheel=a.wheel})},a.closeSended=function(){a.$parent.shadow=!1,a.$parent.sended=!1,a["goto"](1)},a.setSelected=function(b){a.selected=b,a.cambiarAnchor("section"+b)},a.isSelected=function(b){return a.selected===b}}]),angular.module("picbit").controller("UserHomeController",["$scope","$timeout",function(a,b){"use strict";a.toggleHelp=!1,a.twitterData={},a.githubData={},a.instagramData={},a.instagramData.token="2062815740.34af286.169a9c42e1404ae58591d066c00cb979",a.twitterData.token="3072043347-hbcrkzLJfVzTg7BTjgzkKqZx3bbzpYb04IO573x",a.githubData.username="mortega5",a.listComponents=[{name:"twitter-timeline",attributes:{accessToken:a.twitterData.token,secretToken:"VmQX0z3ZWpRv63M92z0SrmmUNGFjNIMZ06iGiJ67kK9oY",consumerKey:"J4bjMZmJ6hh7r0wlG9H90cgEe",consumerSecret:"8HIPpQgL6d3WWQMDN5DPTHefjb5qfvTFg78j1RdZbR19uEPZMf",endpoint:a.domain+"/api/aux/twitterTimeline",language:"{{idioma}}",count:"200"}},{name:"github-events",attributes:{username:a.githubData.username,token:a.githubData.token||"",mostrar:"10",language:"{{idioma}}"}},{name:"instagram-timeline",attributes:{accessToken:a.instagramData.token,endpoint:a.domain+"/api/aux/instagramTimeline",language:"{{idioma}}"}}],a.listComponentAdded=[],a.modifySelected=a.modifySelected||"",a.menuStatus=!1,a.sort=[!1,!1,!1],a.showElement=!1,a.listaOpciones=["false","false","false"],a.showMenu=function(){a.menuStatus?(document.querySelector("#menu-icon").icon="arrow-back",a.menuStatus=!1,a.showElement=!1,a.selected="",a.showSingle="",a.listaOpciones=["false","false","false"],document.querySelector("#arrowAdd").icon="arrow-drop-down",document.querySelector("#arrowDelete").icon="arrow-drop-down",document.querySelector("#arrowModify").icon="arrow-drop-down"):(document.querySelector("#menu-icon").icon="arrow-forward",a.menuStatus=!0,b(function(){a.showElement=!0},350))},a.ocultar=function(b){switch(b){case"add":a.listaOpciones=["true","false","false"],document.querySelector("#arrowDelete").icon="arrow-drop-down",document.querySelector("#arrowModify").icon="arrow-drop-down";break;case"delete":a.listaOpciones=["false","true","false"],document.querySelector("#arrowAdd").icon="arrow-drop-down",document.querySelector("#arrowModify").icon="arrow-drop-down";break;case"modify":a.listaOpciones=["false","false","true"],document.querySelector("#arrowAdd").icon="arrow-drop-down",document.querySelector("#arrowDelete").icon="arrow-drop-down"}},a.setList=function(b){switch(b){case"add":a.listaOpciones=[!a.listaOpciones[0],"false","false"],a.listaOpciones[0]?document.querySelector("#arrowAdd").icon="arrow-drop-down":(document.querySelector("#arrowAdd").icon="arrow-drop-up",document.querySelector("#arrowDelete").icon="arrow-drop-down",document.querySelector("#arrowModify").icon="arrow-drop-down");break;case"delete":a.listaOpciones=["false",!a.listaOpciones[1],"false"],a.listaOpciones[1]?document.querySelector("#arrowDelete").icon="arrow-drop-down":(document.querySelector("#arrowDelete").icon="arrow-drop-up",document.querySelector("#arrowAdd").icon="arrow-drop-down",document.querySelector("#arrowModify").icon="arrow-drop-down");break;case"modify":a.listaOpciones=["false","false",!a.listaOpciones[2]],a.listaOpciones[2]?document.querySelector("#arrowModify").icon="arrow-drop-down":(document.querySelector("#arrowModify").icon="arrow-drop-up",document.querySelector("#arrowAdd").icon="arrow-drop-down",document.querySelector("#arrowDelete").icon="arrow-drop-down")}},a.hidelist=function(b){switch(b){case"add":return a.listaOpciones[0];case"delete":return a.listaOpciones[1];case"modify":return a.listaOpciones[2];default:return!1}},a.isSelected=function(b){return a.selected===b&&void 0!==b},a.setSelected=function(c){a.selected===c?(a.selected="",a.showSingle="",a.hidelist(c)||a.setList(c)):(a.selected=c,b(function(){a.showSingle=c},350))},a.isMenuHidden=function(b){return!(a.menuStatus|a.isSelected(b))},a.setSort=function(b){switch(b){case"add":a.sort=[!a.sort[0],!1,!1];break;case"delete":a.sort=[!1,!a.sort[1],!1];break;case"modify":a.sort=[!1,!1,!a.sort[2]]}},a.modifyActive=function(b){return b===a.modifySelected},a.setModifySelected=function(b){a.modifySelected=a.modifySelected!==b?b:""},a.isModifySelected=function(b){return b===a.modifySelected},a.deleteTimeline=function(b){angular.element(document.querySelector("#container")).find(b).remove();var c=a.listComponentAdded.indexOf(b);a.listComponentAdded.splice(c,1)},a.deleteTimelineHovered=function(b){a.hovered=b},a.deleteTimelineLeaveHover=function(){a.hovered=""},a.showToggleHelp=function(b){a.toggleHelp=!0,window.onkeydown=a.listenEscKeydown,b.stopPropagation()},a.hideToggleHelp=function(b){a.toggleHelp=!1,window.removeEventListener("onkeydown",a.listenEscKeydow),b&&b.stopPropagation()},a.listenEscKeydown=function(b){a.$apply(function(){27===b.keyCode&&a.hideToggleHelp()})}}]),angular.module("picbit").controller("AboutController",["$scope","$routeParams","$timeout",function(a,b,c){"use strict"}]),angular.module("picbit").controller("ContactController",["$scope","$backend",function(a,b){"use strict";a.sendEmail=function(){var a,c,d,e;if(a=document.querySelector("#message"),c=document.querySelector("#sender"),d=document.querySelector("#subject"),e=document.querySelector("#invalid"),e.innerHTML="",a.value||(e.innerHTML="*El mensaje no debe estar vacio"),c.value&&c.checkValidity()||(e.innerHTML+="<br>*El email debe ser válido"),a.value&&c.checkValidity()&&c.value){var f=function(){a.value="",c.value="",d.value=""};b.sendEmail(a.value,c.value,d.value,f)}}}]),angular.module("picbit").controller("ProfileController",["$scope",function(a){"use strict";a.calC=function(){document.getElementById("nombre").value,document.getElementById("apellido").value,document.getElementById("sender").value},a.takeInfoLog=function(a){if("googleplus"===a.detail.redSocial){a.detail.token}if("facebook"===a.detail.redSocial){a.detail.token,a.detail.userId}if("github"===a.detail.redSocial){a.detail.token}if("linkedin"===a.detail.redSocial){a.detail.token,a.detail.userId}if("instagram"===a.detail.redSocial){a.detail.token,a.detail.userId}if("twitter"===a.detail.redSocial){a.detail.token}},a.sort=!0}]),angular.module("picbit").controller("PrivacyController",["$scope","$routeParams","$timeout",function(a,b,c){a.mailTo=function(){var a="mailto:deus@conwet.com?cc=deus@conwet.com&subject=beta&body="+document.querySelector("#mensaje").value;window.location.href=a}}]),angular.module("picbit").controller("SelectidController",["$scope","$backend","$rootScope",function(a,b,c){"use strict";a.userIdError=!1,a.errorMessage="",a.sendUsername=function(d,e){document.querySelector("#username_input").validity.valid?("click"===d.type||"keyup"===d.type&&13===d.which)&&e?b.getUser(e).then(function(){a.userIdError=!0,a.errorMessage=a.language.select_id.userIdError},function(){b.sendData(c.register.token,c.register.tokenId,e,c.register.redSocial,c.register.oauthVerifier).then(function(){a.userIdError=!1,c.register=void 0,a.changeView("/user/"+e)})}):(a.errorMessage="",a.userIdError=!1):(a.errorMessage=a.language.select_id.invalid_username,a.userIdError=!0)}}]);var picbit=angular.module("picbit");picbit.directive("ngDrag",function(){"use strict";function a(a,b,c){a.move={},b.css({position:"absolute"});for(var d in c.$attr)c.hasOwnProperty(d)&&c.$observe(d,function(){});a.dragging=function(c){if("true"===b.attr("draggable")){var d,e,f;0!==c.clientX&&0!==c.clientY&&(a.move.x=a.move.x||c.clientX-c.target.offsetLeft,a.move.y=a.move.y||c.clientY-c.target.offsetTop,d=c.clientX-c.target.offsetLeft-a.move.x,e=c.clientY-c.target.offsetTop-a.move.y,f=a.calculatePosition(c.target,d,e),c.target.style.top=f.top+"px",c.target.style.left=f.left+"px")}},a.calculatePosition=function(a,b,c){var d={},e={},f={};d.left=a.offsetLeft+b,d.right=a.offsetLeft+b+a.offsetWidth,d.top=a.offsetTop+c,d.bottom=a.offsetTop+c+a.offsetHeight;var g=document.querySelector("#container");return e.top=parseInt(angular.element(g).css("padding-top").split("px")[0])||0,e.right=parseInt(angular.element(g).css("padding-right").split("px")[0])||0,e.bottom=parseInt(angular.element(g).css("padding-bottom").split("px")[0])||0,e.left=parseInt(angular.element(g).css("padding-left").split("px")[0])||0,f.left=g.offsetLeft+e.left<d.left,f.right=g.offsetWidth+g.offsetLeft-e.right>d.right,f.top=g.offsetTop+e.top<d.top,f.bottom=g.offsetHeight+g.offsetTop-e.bottom>d.bottom,d.top=f.top?d.top:g.offsetTop+e.top,d.top=f.bottom?d.top:g.offsetTop+g.offsetHeight-a.offsetHeight-e.bottom,d.left=f.left?d.left:g.offsetLeft+e.left,d.left=f.right?d.left:g.offsetLeft+g.offsetWidth-a.offsetWidth-e.right,d},a.deleteShadow=function(a){var b=document.createElement("img");b.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",a.dataTransfer.setDragImage(b,20,20)},a.deleteMove=function(){a.move={}},b.on("drag",a.dragging),b.on("dragstart",a.deleteShadow),b.on("dragend",a.deleteMove)}return{link:a,scope:!0}}),picbit.directive("ngContainer",function(){"use strict";function a(a,b){a.dropObject=function(a){a.preventDefault(),a.stopPropagation();var c,d,e,f,g,h;if(c=a.dataTransfer.getData("element"),c&&0===document.getElementsByTagName(c).length){if(e=angular.element("<"+c+"/>"),e.attr("ng-drag",""),d=a.dataTransfer.getData("attributes")){d=JSON.parse(d);for(h in d)d.hasOwnProperty(h)&&e.attr(h,d[h])}e.attr("draggable","{{modifySelected === '"+c+"'}}"),b.append(e),b.scope().listComponentAdded.push(c),f=b.injector(),g=f.get("$compile"),g(e)(e.scope());var i=e.scope().calculatePosition(e[0],a.clientX-e[0].offsetLeft,a.clientY-e[0].offsetTop);e.css({position:"absolute",top:i.top+"px",left:i.left+"px"})}},a.dragEntry=function(a){a.preventDefault()},b.on("drop",a.dropObject),b.on("dragover",a.dragEntry)}return{link:a}}),picbit.directive("ngCreateElement",function(){"use strict";function a(a,b){a.comienzo=function(b){b.dataTransfer.setData("element",a.idElement),a.attributes&&b.dataTransfer.setData("attributes",a.attributes);var c;c=document.createElement("img"),c.src=a.imagesrc||"",b.dataTransfer.setDragImage(c,0,0)},b.attr("draggable","true"),b.on("dragstart",a.comienzo)}return{scope:{imagesrc:"@imagesrc",attributes:"@listAttributes",idElement:"@idElement"},link:a}}),angular.module("picbit").service("$anchorSmoothScroll",function(){"use strict";function a(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function b(a){for(var b=document.getElementById(a),c=b.offsetTop,d=b;d.offsetParent&&d.offsetParent!==document.body;)d=d.offsetParent,c+=d.offsetTop;return c}this.scrollTo=function(c){var d=a(),e=b(c),f=e>d?e-d:d-e;if(100>f)return void this.scrollTo(0,e);var g=Math.round(f/100);g=25;var h,i=Math.round(f/25),j=e>d?d+i:d-i,k=0;if(e>d)for(h=d;e>h;h+=i)setTimeout("window.scrollTo(0, "+j+")",k*g),j+=i,j>e&&(j=e),k++;else for(h=d;h>e;h-=i)setTimeout("window.scrollTo(0, "+j+")",k*g),j-=i,e>j&&(j=e),k++}}),angular.module("picbit").service("$backend",["$http","$location","$rootScope","$cookies","$q",function(a,b,c,d,e){"use strict";this.endpoint="https://"+b.host(),this.sendData=function(b,d,e,f,g){var h,i,j;return i=this.endpoint+"/api/oauth/"+f+"/login",j="token_id="+d+"&access_token="+b,j+=e?"&user_identifier="+e:"",j+=g&&"twitter"===f?"&oauth_verifier="+g:"",h={method:"post",url:i,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:j},c.promise=a(h),c.promise},this.getUserId=function(b,d){var e,f;return f=this.endpoint+"/api/oauth/"+d+"/credenciales/"+b,e={methor:"get",url:f,headers:{"Content-Type":"application/x-www-form-urlencoded"}},c.promise=a(e),c.promise},this.getUser=function(b){var d,e;return e=this.endpoint+"/api/usuarios/"+b,d={method:"get",url:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}},c.promise=a(d),c.promise},this.sendEmail=function(b,d,e){var f,g,h;return g=this.endpoint+"/api/contact",h="action=contact&message="+b+"&sender="+d,e&&(h+="&subject="+e),f={method:"post",url:g,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:h},c.promise=a(f),c.promise},this.sendSub=function(b,d,e){var f,g,h;return g=this.endpoint+"/api/subscriptions",h="name="+b+"&email="+d+"&surname="+e,f={method:"post",url:g,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:h},c.promise=a(f),c.promise},this.logout=function(){var b,e,f;return f=d.get("social_network")||"googleplus",e=this.endpoint+"/api/oauth/"+f+"/logout",b={method:"post",url:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}},c.user=void 0,c.isLogged=!1,c.promise=a(b),c.promise}}]),angular.module("picbit").service("$cookies",function(){"use strict";this.get=function(a){var b="; "+document.cookie,c=b.split("; "+a+"=");return 2===c.length?c.pop().split(";").shift():void 0},this.put=function(a,b,c,d,e,f){var g;g=a+"="+b,c&&(g+="; expires="+c),g+=d?"; Path="+d:"; path=/",e&&(g+="; domain="+e),f&&(g+="; secure"),document.cookie=g},this.remove=function(a){document.cookie=a+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},this.set=function(a,b,c,d,e,f){this.put(a,b,c,d,e,f)},this.getAll=function(){return document.cookie}}),angular.module("picbit").factory("RequestLanguage",["$http",function(a){return{language:function(b){return a.get("../../language/"+b).success(function(a){return a}).error(function(a){return a})}}}]),angular.module("picbit").filter("arrayFilter",function(){"use strict";return function(a,b){var c=[];return angular.forEach(a,function(a){-1===b.indexOf(a.name)&&c.push(a)}),c}});